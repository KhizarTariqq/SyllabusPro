import trainingDataStrings as strings
import spacy
from spacy.tokens import DocBin

nlp = spacy.blank("en")

training_data = [
    (strings.PHY100, [(4191, 4279, "SYLLABUSITEM"), (4280, 4404, "SYLLABUSITEM"), (4405, 4511, "SYLLABUSITEM"), (4512, 4599, "SYLLABUSITEM")]),
    (strings.CSC263, [(2537, 2576, "SYLLABUSITEM"), (2577, 2616, "SYLLABUSITEM"), (2675, 2713, "SYLLABUSITEM"), (2714, 2770, "SYLLABUSITEM"), (2771, 2810, "SYLLABUSITEM"), (2811, 2876, "SYLLABUSITEM"), (2877, 2945, "SYLLABUSITEM"), (2946, 2979, "SYLLABUSITEM"), (2980, 3046, "SYLLABUSITEM"), (3047, 3133, "SYLLABUSITEM"), (3134, 3183, "SYLLABUSITEM")]),
    (strings.MAT301, [(1772, 1810, "SYLLABUSITEM"), (1811, 1849, "SYLLABUSITEM"), (1850, 1904, "SYLLABUSITEM"), (1905, 1928, "SYLLABUSITEM")]),
    (strings.CSC258, [(2411, 2505, "SYLLABUSITEM"), (2506, 2593, "SYLLABUSITEM"), (2594, 2667, "SYLLABUSITEM"), (2668, 2738, "SYLLABUSITEM"), (2739, 2809, "SYLLABUSITEM"), (2810, 2887, "SYLLABUSITEM"), (2888, 2990, "SYLLABUSITEM"), (2991, 3079, "SYLLABUSITEM")]),
    (strings.CSC324, [(3572, 3616, "SYLLABUSITEM"), (3617, 3676, "SYLLABUSITEM"), (3677, 3737, "SYLLABUSITEM"), (3738, 3756, "SYLLABUSITEM"), (3757, 3804, "SYLLABUSITEM")]),
    (strings.CSC373, [(2905, 2984, "SYLLABUSITEM"), (2985, 3010, "SYLLABUSITEM"), (3011, 3049, "SYLLABUSITEM"), (3050, 3075, "SYLLABUSITEM"), (3076, 3114, "SYLLABUSITEM"), (3115, 3140, "SYLLABUSITEM"), (3141, 3166, "SYLLABUSITEM"), (3167, 3205, "SYLLABUSITEM"), (3206, 3281, "SYLLABUSITEM")]),
    (strings.CSC384, [(2371, 2415, "SYLLABUSITEM"), (2416, 2458, "SYLLABUSITEM"), (2459, 2502, "SYLLABUSITEM"), (2503, 2552, "SYLLABUSITEM"), (2553, 2588, "SYLLABUSITEM"), (2589, 2624, "SYLLABUSITEM"), (2625, 2660, "SYLLABUSITEM"), (2661, 2693, "SYLLABUSITEM"), (2694, 2726, "SYLLABUSITEM"), (2727, 2761, "SYLLABUSITEM"), (2762, 2802, "SYLLABUSITEM"), (2803, 2843, "SYLLABUSITEM"), (2844, 2884, "SYLLABUSITEM"), (2885, 2917, "SYLLABUSITEM"), (2918, 2974, "SYLLABUSITEM"), (2975, 3007, "SYLLABUSITEM"), (3008, 3032, "SYLLABUSITEM"), (3033, 3066, "SYLLABUSITEM")]),
    (strings.CSC311, [(4243, 4309, "SYLLABUSITEM"), (4310, 4365, "SYLLABUSITEM"), (4366, 4402, "SYLLABUSITEM"), (4403, 4439, "SYLLABUSITEM"), (4440, 4492, "SYLLABUSITEM"), (4493, 4552, "SYLLABUSITEM"), (4553, 4571, "SYLLABUSITEM"), (4572, 4631, "SYLLABUSITEM")]),
    (strings.CSC343, [(3844, 3881, "SYLLABUSITEM"), (3882, 3919, "SYLLABUSITEM"), (3920, 3957, "SYLLABUSITEM"), (3958, 3995, "SYLLABUSITEM"), (3996, 4175, "SYLLABUSITEM"), (4176, 4290, "SYLLABUSITEM")]),
    (strings.CHM110, [(4408, 4476, "SYLLABUSITEM"), (4538, 4619, "SYLLABUSITEM"), (4620, 4698, "SYLLABUSITEM"), (4699, 4778, "SYLLABUSITEM"), (4779, 4853, "SYLLABUSITEM"), (4854, 4902, "SYLLABUSITEM"), (4903, 4951, "SYLLABUSITEM"), (4952, 4991, "SYLLABUSITEM")]),
    (strings.CHM211, [(2904, 2933, "SYLLABUSITEM"), (3001, 3040, "SYLLABUSITEM"), (3041, 3101, "SYLLABUSITEM"), (3102, 3141, "SYLLABUSITEM"), (3142, 3196, "SYLLABUSITEM")]),
    (strings.CSC413, [(3905, 3963, "SYLLABUSITEM"), (3964, 4027, "SYLLABUSITEM"), (4028, 4091, "SYLLABUSITEM"), (4092, 4150, "SYLLABUSITEM"), (4151, 4209, "SYLLABUSITEM"), (4210, 4282, "SYLLABUSITEM"), (4283, 4346, "SYLLABUSITEM")]),
    (strings.MAT134, [(2295, 2388, "SYLLABUSITEM"), (2454, 2525, "SYLLABUSITEM"), (2526, 2624, "SYLLABUSITEM"), (2625, 2715, "SYLLABUSITEM"), (2716, 2742, "SYLLABUSITEM"), (2743, 2769, "SYLLABUSITEM"), (2770, 2820, "SYLLABUSITEM"), (2821, 2839, "SYLLABUSITEM")]),
    (strings.MAT223, [(7910, 7975, "SYLLABUSITEM"), (7976, 8010, "SYLLABUSITEM"), (8011, 8067, "SYLLABUSITEM"), (8068, 8100, "SYLLABUSITEM"), (8101, 8133, "SYLLABUSITEM"), (8134, 8152, "SYLLABUSITEM")]),
    (strings.MAT334, [(1617, 1709, "SYLLABUSITEM"), (1710, 1759, "SYLLABUSITEM"), (1760, 1810, "SYLLABUSITEM"), (1811, 1837, "SYLLABUSITEM")]),
    (strings.MAT344, [(2858, 2905, "SYLLABUSITEM"), (2906, 2966, "SYLLABUSITEM"), (2967, 3025, "SYLLABUSITEM")]),
    (strings.STA260, [(4469, 4500, "SYLLABUSITEM"), (4501, 4532, "SYLLABUSITEM"), (4533, 4557, "SYLLABUSITEM")]),
    (strings.ECO311, [(2525, 2553, "SYLLABUSITEM"), (2556, 2582, "SYLLABUSITEM"), (2585, 2612, "SYLLABUSITEM"), (5197, 5244, "SYLLABUSITEM")]),
    (strings.ECO101, [(1018, 1065, "SYLLABUSITEM"), (1066, 1101, "SYLLABUSITEM"), (1102, 1134, "SYLLABUSITEM"), (1135, 1176, "SYLLABUSITEM"), (1177, 1221, "SYLLABUSITEM"), (1222, 1263, "SYLLABUSITEM")]),
    (strings.ECO200, [(899, 929, "SYLLABUSITEM"), (938, 985, "SYLLABUSITEM")]),
    (strings.CSC209, [(2146, 2183, "SYLLABUSITEM"), (2184, 2251, "SYLLABUSITEM"), (2252, 2296, "SYLLABUSITEM"), (2357, 2418, "SYLLABUSITEM"), (2419, 2457, "SYLLABUSITEM"), (2458, 2502, "SYLLABUSITEM"), (2503, 2553, "SYLLABUSITEM"), (2554, 2599, "SYLLABUSITEM"), (2600, 2668, "SYLLABUSITEM")]),
    # (strings.LIN205, []),
    (strings.STA258, [(3253, 3320, "SYLLABUSITEM"), (3339, 3404, "SYLLABUSITEM"), (3423, 3461, "SYLLABUSITEM"), (3462, 3484, "SYLLABUSITEM"), (3485, 3525, "SYLLABUSITEM")]),
]

validation_data = [
    (strings.STA302, [(8707, 8774, "SYLLABUSITEM"), (8775, 8843, "SYLLABUSITEM"), (8844, 8901, "SYLLABUSITEM"), (8902, 8946, "SYLLABUSITEM"), (8947, 8999, "SYLLABUSITEM"), (9024, 9081, "SYLLABUSITEM"), (9082, 9132, "SYLLABUSITEM"), (9133, 9187, "SYLLABUSITEM"), (9188, 9246, "SYLLABUSITEM")]),
    (strings.STA304, [(4739, 4757, "SYLLABUSITEM"), (4758, 4776, "SYLLABUSITEM"), (4777, 4790, "SYLLABUSITEM"), (4791, 4851, "SYLLABUSITEM"), (4852, 4912, "SYLLABUSITEM"), (4913, 4952, "SYLLABUSITEM"), (4953, 4971, "SYLLABUSITEM"), (4972, 4998, "SYLLABUSITEM"), (4999, 5030, "SYLLABUSITEM"), (5031, 5062, "SYLLABUSITEM")]),
]

for i, (text, entities) in enumerate(training_data):
    doc = nlp.make_doc(text)
    for start, end, label in entities:
        span = doc.char_span(start, end, label=label)
        if span is None:
            print(text)
            print(f"Invalid span in item {i}: ({start}, {end}, {label})")
            print(f"Text segment: {repr(text[start:end])}")
        else:
            print(f"Span OK in item {i}: {repr(span.text)}")

# the DocBin will store the example documents
db = DocBin()
for text, annotations in training_data:
    doc = nlp(text)
    ents = []
    for start, end, label in annotations:
        span = doc.char_span(start, end, label=label)
        ents.append(span)
    doc.ents = ents
    db.add(doc)
db.to_disk("./train.spacy")

db2 = DocBin()
for text, annotations in validation_data:
    doc = nlp(text)
    ents = []
    for start, end, label in annotations:
        span = doc.char_span(start, end, label=label)
        ents.append(span)
    doc.ents = ents
    db2.add(doc)
db2.to_disk("./dev.spacy")